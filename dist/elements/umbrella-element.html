<!-- Webcomponents -->
<link rel="import" href="../vendor/polymer/polymer.html">
<link rel="import" href="combine-vote.html">
<link rel="import" href="db-save.html">
<link rel="import" href="db-retrieve.html"> 
<link rel="import" href="stat-widget.html">
<link rel="import" href="map-element.html">
<link rel="import" href="../vendor/core-collapse/core-collapse.html">
    
<polymer-element name="cth-housemouse">

    <template>

		<!-- Bootstrap Core CSS -->
		<link href="../styles/bootstrap.min.css" rel="stylesheet" type="text/css">

		<!-- font for arrow -->
        <link href="../styles/font-awesome.min.css" rel="stylesheet" type="text/css">

		<!-- Custom Theme CSS -->
		<link href="../styles/style.css" rel="stylesheet">


		<nav id="page-top" class="navbar navbar-custom  navbar-fixed-top  clearTransform" role="navigation">
		    <div class="container">
		        <div class="navbar-header">
		            <a class="navbar-brand" href="#page-top">
		              <span class="light"></span>
		            </a>
		        </div>

		        <div class="navrectangle ">
		            <ul class="nav navbar-nav">
		                <li class="page-scroll bol">
		                    <a href="../#page-top"></a>
		                </li>
		                <li class="page-scroll bol">
		                    <a href="../#vote"></a>
		                </li>
		                <li class="page-scroll bol">
		                    <a href="../#map"></a>
		                </li>
		                <li class="page-scroll bol">
		                    <a href="../#stats"></a>
		                </li>
		            </ul>
		         
		        </div>

		    </div>
		</nav>  
        
        <section class="intro p1">
            <div class="intro-body">
                	<div class="logowrapper">
                        <img data-scroll-reveal="enter from bottom 10px over .8s after 0.3s" class="logowhatdoes" src="../images/whatdoes.svg"/>
				        <img data-scroll-reveal="enter from bottom 10px over .9s after 1s" class="logohouse" src="../images/house.svg"/>
				        <img data-scroll-reveal="enter from bottom 10px over .9s after 1.5s" class="logomeantoyou" src="../images/meantoyou.svg"/>
				    </div>     
            </div>
        </section>
        
        <core-collapse id="collapseVote" class="cCollapse" fixedsize duration="4">
            <section id="vote" class="intro p2">
                <combine-vote class="polymerContent" singleVote="{{ singleVote }}"></combine-vote>
            </section>
        </core-collapse>
        
        <db-save combinedvote="{{ singleVote }}"></db-save>
        <db-retrieve publishedData="{{ retrieved }}"></db-retrieve>
        
        <core-collapse id="collapseCecking" duration="1">
            <section class="consoleContainer">
                <div id="consoleTextVote" class="consoleText">
                </div>
            </section>
        </core-collapse>    

        <core-collapse class="cCollapse" id="collapseMap" fixedsize duration="4">
            <section id="map" class="intro p3">
                <!-- <map-element class="polymerContent vCenter" data="{{retrieved}}"></map-element> -->
            </section>
        </core-collapse>
        
        <core-collapse class="cCollapse" id="collapseStats" fixedsize duration="4">
            <section id="stats" class="intro p4">      
                <stat-widget class="polymerContent" vote="{{ singleVote }}"></stat-widget>
            </section>
        </core-collapse>

        <section class="p5">
            <div class="footer">    
                <a class="footerText" href="disclaimer.html"> disclaimer </a> 
            </div>  
        </section>
		
    </template>
    

    <script>
        Polymer('cth-housemouse', {

            singleVoteChanged: function(){
                console.log('singleVote CHANGED!')
                this.shadowRoot.querySelector('#collapseCecking').toggle();
                this.checkingData();
            },

            ready: function() {

                // Wrote a workarround to target our elements inside the shadowRoot correctly, its a dirty fix, but it works. Might be that another library would work better for our case. The animation isn't that complicated. 

                window.workArroundScrollReveal = this.shadowRoot.querySelectorAll('[data-scroll-reveal]');

                // Normal call of scrollReveal

                window.scrollReveal = new scrollReveal();

                // Navbar workarround

                //targetting the <a> tags within the pagescrollbullets
                var navSelector = this.shadowRoot.querySelectorAll('.page-scroll a');

                // Global shadowRootFix
                window.shadowRootFix = this.shadowRoot;

                // jQuery for page scrolling feature - requires jQuery Easing plugin
                $(function() {
                    $(navSelector).bind('click', function(event) {

                        var cleanID = $(this).attr('href');
                        var targetSelector = window.shadowRootFix.querySelector(cleanID);
                        var targetOffset = targetSelector.offsetTop;

                        $('html, body').stop().animate({
                            scrollTop: targetOffset
                            }, 1500, 'easeInOutExpo');

                        event.preventDefault();
                        
                    });
                });

                // calling the unwind of the Vote element

                var shadowFix = this.shadowRoot;

                function openVote() {
                    shadowFix.querySelector('#collapseVote').toggle();
                };

                setTimeout(openVote, 3000);

            },
            checkingData: function() {

                var text = [
                    "&lt;hi&gt;",
                    "&lt;bye&gt;",
                    "&lt;Yeah!&gt;",
                    "&lt;NOOOOO!&gt;",
                    "&lt;Done&gt;",
                    "&gt;&#95;"
                ];

                var shadowFix = this.shadowRoot;

                var i = 0;
                var newTop = 82;

                function addConsoleTag() {
                    // making room for new value
                    newTop = newTop - 32;
                    var newTopPx = newTop + "px";
                    shadowFix.querySelector('#consoleTextVote').style.top = newTopPx;

                    // adding the new one
                    var addition = "<p style=\"margin: 0 ;\">" + text[i] + "</p>";
                    shadowFix.querySelector('#consoleTextVote').innerHTML += addition;

                    // opening the final
                    if (i== text.length - 1) {
                        shadowFix.querySelector('#collapseMap').toggle();
                        shadowFix.querySelector('#collapseStats').toggle();
                    }

                    i++;
                    if (i < text.length) {
                        setTimeout(addConsoleTag, 500);
                    };

                };

                addConsoleTag();
            }


        });
        
    </script>
</polymer-element>